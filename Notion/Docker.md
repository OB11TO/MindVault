### Установка Docker

Один из вариантов запустить скрипт

```Java
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh --dry-run
```

Добавляем текущего юзера

```Java
sudo usermod -aG docker $USER
```

### Основные команды

- `docker run mysql` запустит экземпляр приложения на хосте, если образ есть на хосте, иначе спулит с докер хаба
- `docker ps` посмотреть контейнеры запущенные, id и имя присваивается рандомно, если имя не указано при создании контейнера.
    
    ![[images/Untitled 156.png|Untitled 156.png]]
    
- `docker ps -a` посмотреть все контейнеры, даже незапущенные
- `docker stop имя/id` останавливает контейнер
- `docker rm id/name` удаляет остановленные и в статусе exited контейнеры
- `docker images` посмотреть весь список образов
- `docker rm id` удаление образов. ВАЖНО необходимо останавливать контейнеры, которые используют этот образ

### Образы/ images

Пример создания докер образа:

1. Прописываем инструкцию в докер файле
    
    ![[images/Untitled 1 17.png|Untitled 1 17.png]]
    
2. Билдим докер образ  
      
    `docker build . -t onemyname/webapp`
3. Отправляем в докер хаб  
    `docker push rotorocloud/webapp  
    

Docker file пишется в следующем формате

![[images/Untitled 2 16.png|Untitled 2 16.png]]

![[images/Untitled 3 15.png|Untitled 3 15.png]]

Инструкция докера состоит из слоев, эти слои кэшируются во время сборки. При проблемах сборки, не приходится выполнять все действия сначала. У каждого слоя есть хэш для поиска быстрого.

![[images/Untitled 4 15.png|Untitled 4 15.png]]

![[images/Untitled 5 15.png|Untitled 5 15.png]]

  

- Чтобы узнать информацию о слоях используется команда `docker history name_image`

  

### Что контейниризуется?

Да все что угодно:) главное, чтобы решение контейниризации было выгоднее инсталляции

![[images/Untitled 6 14.png|Untitled 6 14.png]]

### Создать локально контейнер postgres

```Java
docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres
```

1. `docker run`: Это команда Docker, которая используется для создания и запуска контейнеров.
2. `-name some-postgres`: Эта опция задает имя контейнера, в данном случае, имя контейнера установлено как "some-postgres". Это имя можно использовать для удобства идентификации контейнера в будущем при работе с ним.
3. `e POSTGRES_PASSWORD=mysecretpassword`: Эта опция устанавливает переменную окружения в контейнере. В данном случае, переменная окружения `POSTGRES_PASSWORD` устанавливается в значение "mysecretpassword". Это используется для установки пароля для административного доступа к PostgreSQL базе данных.
4. `d postgres`: Эта опция указывает образ, который будет использоваться для создания контейнера. Здесь указан образ PostgreSQL, и контейнер будет создан с использованием этого образа.

  

Также можно указать порт через `-p`

```Java
docker run --name myPSQL -e POSTGRES_PASSWORD= postgres -p 5433:5432 -d postgres
```

Также можно указать порт через версию, по умолчанию будет `:latest`

```Java
docker run --name myPSQL -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=password -p 5433:5434 -d postgres:16.0
```

### Переменные окружения

1. `POSTGRES_PASSWORD`:
    - Эта переменная окружения обязательна для использования образа PostgreSQL.
    - Устанавливает пароль суперпользователя (superuser) для PostgreSQL.
    - Задает пароль, который будет использоваться при административном доступе к базе данных.
    - Пароль задается во время инициализации контейнера и может быть изменен.
2. `POSTGRES_USER`:
    - Эта необязательная переменная окружения используется в сочетании с `POSTGRES_PASSWORD`.
    - Создает пользователя с указанным именем и присваивает ему права суперпользователя (superuser).
    - Также создает базу данных с тем же именем, что и пользователь.
    - Если не указана, используется пользователь по умолчанию "postgres".
3. `POSTGRES_DB`:

```Java
docker run --name my-postgres
 -e POSTGRES_USER=myuser
 -e POSTGRES_PASSWORD=mypassword
 -e POSTGRES_DB=mydb -d postgres
```

- Эта необязательная переменная окружения может быть использована для задания имени базы данных, которая будет создана при запуске контейнера.
- Если не указана, будет использовано значение `POSTGRES_USER` в качестве имени базы данных.

1. `POSTGRES_INITDB_ARGS`:
    - Эта необязательная переменная окружения позволяет передать аргументы в `postgres initdb`.
    - Аргументы передаются как строка с пробелами и используются для настройки различных параметров базы данных.
    - Например, можно использовать для включения функциональности, такой как проверка суммы страниц данных (`-data-checksums`).
2. `POSTGRES_INITDB_WALDIR`:
    - Эта необязательная переменная окружения используется для указания альтернативного расположения журнала транзакций PostgreSQL.
    - По умолчанию журнал хранится в подкаталоге основной директории данных PostgreSQL (`PGDATA`).
    - Это может быть полезно для разделения данных и журнала транзакций по разным хранилищам.
3. `POSTGRES_HOST_AUTH_METHOD`:
    - Эта необязательная переменная окружения используется для управления методами аутентификации при подключении к базе данных через хосты (не локально).
    - Может устанавливаться на различные значения, такие как "scram-sha-256" или "md5", в зависимости от требуемой аутентификации.
    - Не рекомендуется использовать "trust", так как это позволяет подключаться без пароля.
4. `PGDATA`:

```Java
docker run --name my-postgres -e
 PGDATA=/var/lib/postgresql/data/mydata -d postgres
```

- Эта необязательная переменная окружения задает расположение данных PostgreSQL.
- По умолчанию, данные хранятся в `/var/lib/postgresql/data`.
- Эту переменную можно использовать для определения альтернативного расположения данных.

Каждая из этих переменных окружения помогает настроить и запустить контейнер PostgreSQL с различными параметрами, включая пароли, пользователей, имена баз данных, методы аутентификации и многое другое, что делает контейнер PostgreSQL более гибким и настраиваемым в зависимости от вашего приложения и требований.

### Как сбилдить образ и запушить на docker hub

Создаем какую либо инструкцию в файл с названием `Dockerfile`

```Java
FROM ubuntu
RUN apt-get update
RUN apt-get install -y python3 python3-pip
RUN pip3 install flask
RUN cd /opt
COPY app.py /opt/app.py
ENTRYPOINT FLASK_APP=app.py flask run --host=0.0.0.0 --port=5000
```

Билдим в корневом проекте `docker build .`

```Java
vadim@vadimPC:~/Documents/webapp$ docker build .
```

Так как мы не указали название образа и tag образ будет создан с пустым названием и тегом

Меняем: `docker tag id название образа: tag`

```Java
docker tag 2cff3d5ad911 onemyname/webapp:ubuntu
```

Необходимо залогиниться через `docker login`

После отправить `docker push onemyname/webapp:ubuntu`

### Переменные окружения

Чтобы избавиться от сборки разных билдов с разными аргументами можно сздать переменную окружения

```Java
/// code

myEnv = os.environ.get('MY_ENV_VALUE')

// code
```

```Java
export MY_ENV_VALUE = 1; python3 app.py
```

И соответственно запустить образ с параметром -e

```Java
docker run -e MY_ENV_VALUE = 1 onemyname/webapp
```

  

Чтобы посмотреть переменные окружения, используемые в контейнере можно использовать комманду `docker inspect`

### Шпаргалки

```Bash
docker run -p 8080:8080 --name hydro hydro:hydro-0.0.1 --spring.profiles.active=sandbox
```

![[images/Untitled 7 13.png|Untitled 7 13.png]]